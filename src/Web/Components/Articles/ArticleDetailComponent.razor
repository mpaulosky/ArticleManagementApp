@* =======================================================
Copyright (c) 2025. All rights reserved.
File Name :     ArticleDetailComponent.razor
Company :       ArticleManagementApp
Author :        GitHub Copilot
Solution Name : ArticleManagementApp
Project Name :  Web
======================================================= *@

@inject ICategoryRepository CategoryRepository
@inject ILogger<ArticleDetailComponent> Logger

@if (Article is not null)
{
	<article class="article-detail @CssClass">
		<header class="article-header mb-4 pb-4 border-bottom">
			<div class="d-flex justify-content-between align-items-start mb-3">
				<h1 class="display-5">@Article.Title</h1>
				@if (Article.IsPublished)
				{
					<span class="badge bg-success fs-6">Published</span>
				}
				else
				{
					<span class="badge bg-secondary fs-6">Draft</span>
				}
			</div>

			<div class="article-meta text-muted">
				<div class="row">
					<div class="col-md-6">
						<div class="mb-2">
							<i class="bi bi-person-fill me-2"></i>
							<strong>Author:</strong> @Article.Author
						</div>
						<div class="mb-2">
							<i class="bi bi-calendar-fill me-2"></i>
							<strong>Published:</strong> @(Article.PublishedAt?.ToString("MMMM dd, yyyy") ?? "Not published")
						</div>
					</div>
					<div class="col-md-6">
						<div class="mb-2">
							<i class="bi bi-folder-fill me-2"></i>
							<strong>Category:</strong> 
							@if (_category is not null)
							{
								<span>@_category.Name</span>
							}
							else
							{
								<span class="text-muted">Loading...</span>
							}
						</div>
						<div class="mb-2">
							<i class="bi bi-eye-fill me-2"></i>
							<strong>Views:</strong> @Article.ViewCount
						</div>
					</div>
				</div>
			</div>

			@if (Article.Tags is not null && Article.Tags.Count > 0)
			{
				<div class="article-tags mt-3">
					<i class="bi bi-tags-fill me-2"></i>
					@foreach (var tag in Article.Tags)
					{
						<span class="badge bg-light text-dark border me-1">@tag</span>
					}
				</div>
			}
		</header>

		@if (!string.IsNullOrWhiteSpace(Article.Summary))
		{
			<div class="article-summary alert alert-light mb-4">
				<strong>Summary:</strong>
				<p class="mb-0 mt-2">@Article.Summary</p>
			</div>
		}

		<div class="article-content">
			@* TODO: Add Markdown rendering when Markdown library is available *@
			<div class="content-body">
				@foreach (var paragraph in Article.Content.Split("\n\n"))
				{
					<p>@paragraph</p>
				}
			</div>
		</div>

		<footer class="article-footer mt-5 pt-4 border-top">
			<div class="d-flex justify-content-between align-items-center">
				<div class="text-muted small">
					<div>Created: @Article.CreatedAt.ToString("MMMM dd, yyyy 'at' hh:mm tt")</div>
					@if (Article.UpdatedAt != Article.CreatedAt)
					{
						<div>Last updated: @Article.UpdatedAt.ToString("MMMM dd, yyyy 'at' hh:mm tt")</div>
					}
				</div>
				@if (ShowActions)
				{
					<div class="btn-group">
						<a href="/articles/edit/@Article.Id" class="btn btn-outline-primary">
							<i class="bi bi-pencil me-1"></i> Edit
						</a>
						<a href="/articles" class="btn btn-outline-secondary">
							<i class="bi bi-arrow-left me-1"></i> Back to Articles
						</a>
					</div>
				}
			</div>
		</footer>
	</article>
}
else
{
	<div class="alert alert-warning">
		<i class="bi bi-exclamation-triangle me-2"></i>
		Article not found.
	</div>
}

@code {
	/// <summary>
	/// Gets or sets the article to display.
	/// </summary>
	[Parameter]
	public Article? Article { get; set; }

	/// <summary>
	/// Gets or sets whether to show action buttons.
	/// </summary>
	[Parameter]
	public bool ShowActions { get; set; } = true;

	/// <summary>
	/// Gets or sets additional CSS classes to apply to the component.
	/// </summary>
	[Parameter]
	public string CssClass { get; set; } = string.Empty;

	private Category? _category;

	protected override async Task OnParametersSetAsync()
	{
		if (Article is not null && !string.IsNullOrWhiteSpace(Article.CategoryId))
		{
			await LoadCategoryAsync();
		}
	}

	private async Task LoadCategoryAsync()
	{
		try
		{
			_category = await CategoryRepository.GetByIdAsync(Article!.CategoryId);
		}
		catch (Exception ex)
		{
			Logger.LogError(ex, "Error loading category for article");
		}
	}
}
